{% load static %}

<!DOCTYPE html>
<html lang="en">

<link rel="stylesheet" href="https://github.com/downloads/lafeber/world-flags-sprite/flags16.css" />

<head>
    {% include "includes/head.html" %}

    <style>
        .limited-width {
            max-width: 500px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            word-wrap: break-word;

        }
        .onoffswitch {
    position: relative; width: 67px;
    -webkit-user-select:none; -moz-user-select:none; -ms-user-select: none;
}
.onoffswitch-checkbox {
    position: absolute;
    opacity: 0;
    pointer-events: none;
}
.onoffswitch-label {
    display: block; overflow: hidden; cursor: pointer;
    border: 2px solid #999999; border-radius: 20px;
}
.onoffswitch-inner {
    display: block; width: 200%; margin-left: -100%;
    transition: margin 0.3s ease-in 0s;
}
.onoffswitch-inner:before, .onoffswitch-inner:after {
    display: block; float: left; width: 50%; height: 30px; padding: 0; line-height: 30px;
    font-size: 14px; color: white; font-family: Trebuchet, Arial, sans-serif; font-weight: bold;
    box-sizing: border-box;
}
.onoffswitch-inner:before {
    content: "ON";
    padding-left: 10px;
    background-color: #34A7C1; color: #FFFFFF;
}
.onoffswitch-inner:after {
    content: "OFF";
    padding-right: 10px;
    background-color: #EEEEEE; color: #999999;
    text-align: right;
}
.onoffswitch-switch {
    display: block; width: 15px; margin: 7.5px;
    background: #FFFFFF;
    position: absolute; top: 0; bottom: 0;
    right: 33px;
    border: 2px solid #999999; border-radius: 20px;
    transition: all 0.3s ease-in 0s; 
}
.onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-inner {
    margin-left: 0;
}
.onoffswitch-checkbox:checked + .onoffswitch-label .onoffswitch-switch {
    right: 0px; 
}
    </style>
</head>

<body class="hold-transition sidebar-mini layout-fixed">

    <div class="wrapper">
        {%include 'includes/loader.html'%}
        {% include 'includes/topNavbar.html' %}
        {% include 'includes/sideNavbar.html' %}
        <div class="content-wrapper">
            <div class="content-header">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card shadow hidden-transition">
                                <div class="card-body">
                                    <figure class="highcharts-figure">
                                        <div id="splineChart"></div>
                                        <p class="highcharts-description">
                                        </p>
                                    </figure>
                                </div>
                            </div>
                        </div>

                        <!-- dynamic count cards -->
                        <div class="col-lg-4" style="margin: auto;">
                            <div class="card hidden-transition">
                                <div class="card-body">
                                    <div class="d-flex align-items-top ">
                                        <div class="flex-fill">
                                            <h5 class="d-block fw-semibold  mb-1">Total - Survey</h5>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="d-block ">
                                                    <div class="fw-semibold counter"
                                                        style="font-size: x-large; text-align: center;">
                                                        {{surveys_count}} </div>
                                                    <a href="#" class="nav-link text-primary">
                                                        View All
                                                        <i class="bi bi-arrow-right-circle"></i>
                                                    </a>
                                                </div>
                                                <a class="btn btn-app"
                                                    style="background-color: #0eadfc; border-radius: 10px;">
                                                    <i class=" bi bi-file-earmark-text bi-main"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="card hidden-transition">
                                <div class="card-body">
                                    <div class="d-flex align-items-top ">
                                        <div class="flex-fill">
                                            <h5 class="d-block fw-semibold  mb-1"> Questions </h5>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="d-block ">
                                                    <div class=" counter"
                                                        style="font-size: x-large; text-align: center;"> {{questions}}
                                                    </div>
                                                    <a href="" class="nav-link" style="color: #5e60ce;">
                                                        View All
                                                        <i class="bi bi-arrow-right-circle"></i>
                                                    </a>
                                                </div>
                                                <a class="btn btn-app"
                                                    style="background-color: #5e60ce; border-radius: 10px;">
                                                    <i class="bi bi-journals bi-main"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <div class="card hidden-transition">
                                <div class="card-body">
                                    <div class="d-flex align-items-top ">
                                        <div class="flex-fill">
                                            <h5 class="d-block fw-semibold  mb-1"> Responses </h5>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="d-block ">
                                                    <div class=" counter"
                                                        style="font-size: x-large; text-align: center;"> {{Response}}
                                                    </div>
                                                    <a href="" class="nav-link " style="color: #7ae582;">
                                                        View All
                                                        <i class="bi bi-arrow-right-circle"></i>
                                                    </a>
                                                </div>
                                                <a class="btn btn-app"
                                                    style="background-color: #7ae582; border-radius: 10px;">
                                                    <i class="bi bi-card-checklist bi-main"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- table -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card hidden-transition">

                                <div class="card-header" style="justify-content: space-between;">
                                    <div class="card-title">
                                        <div id="selected-survey"></div>
                                    </div>
                                    
                                </div>


                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table text-nowrap table-hover border table-bordered"
                                            id="example">
                                            <thead>
                                                <th>Survey Name </th>
                                                <th>Suvey instruction </th>
                                                <th> created_at </th>
                                                <th>start date </th>
                                                <th>end date </th>



                                            </thead>
                                            <tbody id="tbody">
                                                {% for survey in surveys %}
                                                <tr>
                                                    <td>{{ survey.name }}</td>
                                                    <td>{{ survey.instruction }}</td>
                                                    <td>{{ survey.created_at }}</td>
                                                    <td>{{ survey.start_at }}</td>
                                                    <td>{{ survey.end_at }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <!-- search and filter bar -->
            <div class="container-fluid hidden-transition">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active shadow" aria-current="page" href="#"
                            style="background-color: transparent;">Survey Analysis</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'survey_managment:compareData' %}">Compare Data</a>
                    </li>
                </ul>
                <br>


                <div class="container-fluid" style="background-color: #e3f2fd;">
                    <div class="container-fluid" id="searchArea">
                        <h2 class="textS">Search Area</h2>
                        <div class="onoffswitch" style="float: right;">
                            <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox"  id="myonoffswitch" tabindex="0" checked>
                            <label class="onoffswitch-label" for="myonoffswitch">
                                <span class="onoffswitch-inner"></span>
                                <span class="onoffswitch-switch"></span>
                            </label>
                        </div>
                        <div class="row ">



                            {%include "includes/select.html"%}

                        </div>
                    </div>
                </div>

                <br>
            </div>



            <!-- table -->
            <section class="content" style="display: none;" id="section1">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-7">
                            <div class="card hidden-transition">

                                <div class="card-header" style="justify-content: space-between;">
                                    <div class="card-title">
                                        <div id="selected-survey"></div>
                                    </div>
                                    
                                    <button id="exportButton_2" class="btn btn-success">Export to Excel</button>

                                </div>


                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table text-nowrap table-hover border table-bordered"
                                            id="general_Survey_Info">
                                            <thead>
                                                <th> Survey Name </th>
                                                <th> Total Weight </th>
                                                <th> Total Answer </th>
                                                <th> Weighted Sum </th>
                                                <th> Average </th>



                                            </thead>
                                            <tbody id="tbody">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                               
                            </div>
                        </div>
                        <div class="col-lg-5">
                            <figure class="highcharts-figure" >
                                <div id="container"  ></div>
                                <p class="highcharts-description">
                           
                                </p>
                                </figure>
                        </div>
                    </div>
                </div>
            </section>

           
            <!-- table -->
            <section class="content" style="display: none;" id="section2">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card hidden-transition">

                                <div class="card-header" style="justify-content: space-between;">
                                    <div class="card-title">
                                        <div id="selected-survey"></div>
                                    </div>
                                   

                                </div>



                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table text-nowrap table-hover border table-bordered"
                                            id="survey_detail">
                                            <thead>
                                                <th> ጥያቄ</th>
                                                <th> ደረጃ </th>
                                                <th> ክብደት </th>

                                                <th>የተመዘነ ደረጃ</th>
                                                <th> በ100% ኛ </th>
                                                <th> Grading </th>





                                            </thead>
                                            <tbody id="tbody">

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                              
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- two graphs  -->
            <section class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-6 col-md-6">
                            <div class="card shadow hidden-transition">
                                <div class="card-body">
                                    <div class="flex-fill">
                                        <div class="form-group">
                                            <select class="form-control " style="width: 100%;">
                                                <option selected="selected">choose chart</option>
                                                <option>Radial bar chart </option>
                                                <option>California</option>

                                            </select>
                                        </div>
                                        <figure class="highcharts-figure mb-0">
                                            <div id="pieChart"></div>
                                        </figure>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 col-md-6">
                            <div class="card shadow hidden-transition">
                                <div class="card-body">
                                    <figure class="highcharts-figure mb-0">
                                        <div id="barChart"></div>
                                        <p class="highcharts-description"></p>
                                    </figure>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>


        </div>
    </div>



    {% include "includes/scripts.html" %}
    <script>
       
        fetch('http://127.0.0.1:8000/get_json/')
            .then(res => res.json())
            .then(data => {
                var surveyTypeInput = document.getElementById('survey_type');
                // var surveyTableBody_1 = document.getElementById('surveyTable').getElementsByTagName('tbody')[0];
                var surveyTableBody_2 = document.getElementById('survey_detail').getElementsByTagName('tbody')[0];
                var surveyTableBody_3 = document.getElementById('general_Survey_Info').getElementsByTagName('tbody')[0];
                var select_ministry = document.getElementById("ministry-select");
                var selectElement = document.getElementById("survey-select");
                var myCheckbox = document.getElementById('myonoffswitch');
                var mySelect = document.getElementById('survey-select');
                var option_table2 = document.getElementById('section1');
                var option_table1 = document.getElementById('section2');
                var column_chart = document.getElementById('container');
                var store_average = [];
                var store_survey_name = [];

                // Populate the survey type options
                data.survey_type.forEach(surveyType => {
                    var option = document.createElement('option');
                    option.value = surveyType.id;
                    option.textContent = surveyType.name;
                    surveyTypeInput.appendChild(option);
                });

                myCheckbox.addEventListener('change', function () {
                    if (!myCheckbox.checked) {
                        mySelect.disabled = true;
                    } else {
                        mySelect.disabled = false;
                    }
                });


                surveyTypeInput.addEventListener('change', function () {
                    var selectedSurveyTypeId = parseInt(surveyTypeInput.value);
                    console.log('Selected survey:', selectedSurveyTypeId);

                    clearTable(surveyTableBody_2);
                    clearOptions(select_ministry);
                    clearOptions(selectElement);


                    if (selectedSurveyTypeId && myCheckbox.checked) {
                        var surveys = data.survey.filter(survey => survey.survey_type_id === selectedSurveyTypeId);

                        surveys.forEach(survey => {

                            var option = document.createElement("option");
                            option.value = '';
                            option.textContent = 'Select Survey';
                            option.value = survey.id;
                            option.textContent = survey.name;
                            selectElement.appendChild(option);

                            selectElement.addEventListener('change', function () {
                                var selectedSurvey = selectElement.value;
                                console.log('Selected survey:', selectedSurvey);

                                var selectedSurveyId = parseInt(selectElement.value);
                                for (var i = 0; i < data.surveys.length; i++) {
                                    if (data.surveys[i].id === selectedSurveyId) {
                                        selectedSurvey = data.surveys[i];
                                        break;
                                    }
                                }

                                if (selectedSurvey) {
                                    var lineMinistries = selectedSurvey.line_ministries;
                                    while (select_ministry.firstChild) {
                                        select_ministry.removeChild(select_ministry.firstChild)
                                    }
                                    lineMinistries.forEach(function (lineMinistry) {
                                        var ministry_option = document.createElement("option");
                                        ministry_option.value = lineMinistry.id;
                                        ministry_option.textContent = lineMinistry.name;
                                        select_ministry.append(ministry_option)

                                    });
                                    console.log('Line ministries:', lineMinistries);
                                }

                                else {
                                    console.log('Selected survey not found');
                                }
                            });
                            select_ministry.addEventListener("change", function () {
                                if (select_ministry) {
                                    clearTable(surveyTableBody_2)
                                }
                                var selectedLineMinistry = parseInt(select_ministry.value);

                                user = null;
                                weightedSum = 0;
                                data.users.forEach(function (users) {
                                    if (users.Line_ministry_id === selectedLineMinistry) {
                                        user = users.id;
                                        return;
                                    }
                                });
                                userResponseId = null
                                data.user_response.forEach(function (userResponse) {
                                    if (userResponse.submitted_by_id === user) {
                                        userResponseId = userResponse.id;
                                        return;  // Exit the loop once a match is found
                                    }
                                });
                                console.log("yry " + userResponseId)

                                if (userResponseId !== null) {
                                    var answers = data.answer.filter(function (answer) {
                                        return answer.response_id === userResponseId;
                                    });

                                    console.log(answers);
                                    var answerValues = answers.map(function (answer) {
                                        return {
                                            value: parseFloat(answer.answertext),
                                            questionId: answer.forquestion_id
                                        };
                                    });

                                    var weightedSum = 0;
                                    var totalWeight = 0;
                                    var total_weightedinPercent = 0;
                                    var count = 0;
                                    var total_answer = 0;
                                    answerValues.forEach(function (answer) {
                                        var question = data.questions.find(function (q) {
                                            return q.id === answer.questionId;
                                        });


                                        if (question) {
                                            var weight = question.weight;
                                            console.log("the question :" + question.title + "the weight:" + weight)


                                            var total_weight = 0
                                            if (!isNaN(answer.value)) {
                                                weightedSum += answer.value * weight;
                                                totalWeight += weight;
                                                total_answer += answer.value;


                                            }

                                            var weighted__Sum = 0;

                                            if (totalWeight > 0) {
                                                var weightedAverage = weightedSum / totalWeight;
                                                var row = surveyTableBody_2.insertRow();
                                                var question_cell = row.insertCell();
                                                question_cell.textContent = question.title;
                                                row.insertCell().textContent = answer.value;
                                                question_cell.classList.add('limited-width');
                                                row.insertCell().textContent = weight;
                                                console.log(totalWeight)
                                                row.insertCell().textContent = answer.value * weight;
                                                var totalresult = answer.value * weight
                                                var max_value = 10;

                                                var weightedinPercent = ((totalresult) / (max_value * weight)) * 100;
                                                count++;
                                                total_weightedinPercent += weightedinPercent;
                                                // console.log("hello" + total_weightedinPercent + " "+ count);

                                                row.insertCell().textContent = weightedinPercent + "%";
                                                var x = weightedinPercent;
                                                var newCell = row.insertCell();
                                                newCell.id = 'Indicator';
                                                if (x >= 90) {
                                                    newCell.textContent = " Very Good";
                                                    newCell.style.backgroundColor = "#52B788";
                                                } else if (x >= 80) {
                                                    newCell.textContent = "Good";
                                                    newCell.style.backgroundColor = "#C2FA41";
                                                } else if (x >= 60) {
                                                    newCell.textContent = "Satisfactory";
                                                    newCell.style.backgroundColor = "#C1FA61";

                                                } else if (x >= 50) {
                                                    newCell.textContent = "Poor";
                                                    newCell.style.backgroundColor = "#FAEB41";


                                                } else if (x >= 40) {
                                                    newCell.textContent = "Very Poor";
                                                    newCell.style.backgroundColor = " #FA7D41";


                                                } else {
                                                    newCell.textContent = "Extremely Poor";
                                                    newCell.style.backgroundColor = "#FA7D41";


                                                }

                                                console.log("Weighted average of answers: " + weightedAverage.toFixed(2));
                                            } else {
                                                console.log("No valid answers found for the selected line ministry.");
                                            }

                                        }
                                    });

                                }


                                else {
                                    console.log("No user_response ID found for the selected line ministry.");
                                }
                                var totalRow = surveyTableBody_2.insertRow();
                                var labelCell = totalRow.insertCell();
                                labelCell.textContent = 'Total';

                                var valueCell = totalRow.insertCell();
                                valueCell.textContent = total_answer;

                                var weightCell = totalRow.insertCell();
                                weightCell.textContent = totalWeight;

                                var weightCell = totalRow.insertCell();
                                weightCell.textContent = weightedSum;

                                var averageCell = totalRow.insertCell();
                                var average = total_weightedinPercent / count;
                                averageCell.textContent = average.toFixed(2) + "%";
                                surveyTableBody_2.appendChild(totalRow);
                                option_table1.style.display = "block";




                                console.log("Selected line ministry: " + selectedLineMinistry);
                            });
                            var selectedSurvey = (selectElement.value);
                        });

                        // initializeDataTable();
                    }
                    else if (selectedSurveyTypeId && !myCheckbox.checked || !myCheckbox.checked) {
                        var survey_s = data.survey.filter(survey => survey.survey_type_id === selectedSurveyTypeId);
                        if (survey_s) {
                            console.log("Hello");
                            var lineMinistries = []
                            survey_s.forEach(function (survey) {
                                var matchingSurvey = data.surveys.find(s => s.id === survey.id)
                                console.log(matchingSurvey);
                                if (matchingSurvey) {
                                    lineMinistries = lineMinistries.concat(matchingSurvey.line_ministries);
                                }
                            });
                            var uniqueLineMinistries = lineMinistries.filter((ministry, index, self) =>
                                index === self.findIndex(m => m.name === ministry.name)
                            );

                            uniqueLineMinistries.forEach(function (lineMinistry) {
                                var ministry_option = document.createElement("option");
                                ministry_option.value = lineMinistry.id;
                                ministry_option.textContent = lineMinistry.name;
                                select_ministry.append(ministry_option)

                            });

                            select_ministry.addEventListener("change", function () {
                                if (select_ministry) {
                                    clearTable(surveyTableBody_2)
                                    var selectedLineMinistry = parseInt(select_ministry.value);
                                    console.log(selectedLineMinistry)
                                }


                                var surveysWithSelectedMinistry = [];

                                data.surveys.forEach(function (survey) {
                                    if (survey_s.some(function (s) { return s.id === survey.id; })) {
                                        var hasSelectedMinistry = survey.line_ministries.some(function (ministry) {
                                            return ministry.id === selectedLineMinistry;
                                        });

                                        if (hasSelectedMinistry) {
                                            surveysWithSelectedMinistry.push(survey.id);
                                        }
                                    }
                                });

                                console.log(surveysWithSelectedMinistry);


                                user = null;
                                data.users.forEach(function (users) {
                                    if (users.Line_ministry_id === selectedLineMinistry) {
                                        user = users.id;
                                        return;
                                    }
                                });
                                console.log("User Id" + user);



                                surveysWithSelectedMinistry.forEach(function (surveyId) {

                                    var selectedUserResponses = data.user_response.filter(function (userResponse) {
                                        return userResponse.submitted_by_id === user && userResponse.forsurvey_id === surveyId;
                                    });


                                    console.log("user Response for surveyID" + surveyId)
                                    console.log(selectedUserResponses);



                                    userResponseId = null
                                    selectedUserResponses.forEach(function (userResponse) {
                                        if (userResponse.submitted_by_id === user) {
                                            userResponseId = userResponse.id;
                                            return;
                                        }
                                    });
                                    console.log(userResponseId);


                                    if (userResponseId !== null) {
                                        var answers = data.answer.filter(function (answer) {
                                            return answer.response_id === userResponseId;
                                        });

                                        var answerValues = answers.map(function (answer) {
                                            return {
                                                value: parseFloat(answer.answertext),
                                                questionId: answer.forquestion_id
                                            };
                                        });

                                        var weightedSum = 0;
                                        var totalWeight = 0;
                                        var total_weightedinPercent = 0;
                                        var count = 0;
                                        var total_answer = 0;
                                        answerValues.forEach(function (answer) {
                                            var question = data.questions.find(function (q) {
                                                return q.id === answer.questionId;
                                            });


                                            if (question) {
                                                var weight = question.weight;
                                                console.log("the question :" + question.title + "the weight:" + weight)


                                                var total_weight = 0
                                                if (!isNaN(answer.value)) {
                                                    weightedSum += answer.value * weight;
                                                    totalWeight += weight;
                                                    total_answer += answer.value;


                                                }

                                                var weighted__Sum = 0;

                                                if (totalWeight > 0) {
                                                    var weightedAverage = weightedSum / totalWeight;

                                                    // console.log(totalWeight)

                                                    var totalresult = answer.value * weight
                                                    var max_value = 10;

                                                    var weightedinPercent = ((totalresult) / (max_value * weight)) * 100;
                                                    count++;
                                                    total_weightedinPercent += weightedinPercent;
                                                    // console.log("hello" + total_weightedinPercent + " "+ count);

                                                    var x = weightedinPercent;

                                                    console.log("Weighted average of answers: " + weightedAverage.toFixed(2));
                                                } else {
                                                    console.log("No valid answers found for the selected line ministry.");
                                                }

                                            }


                                        });



                                    }

                                    var average = total_weightedinPercent / count;

                                    if (average) {
                                        var totalRow = surveyTableBody_3.insertRow();
                                        var survey = data.survey.find(function (survey) {
                                            return survey.id === surveyId;
                                        });
                                        var surveyName = survey ? survey.name : "survey not found";
                                        store_survey_name.push(surveyName);
                                        totalRow.insertCell().textContent = surveyName;


                                        var valueCell = totalRow.insertCell();
                                        valueCell.textContent = total_answer;

                                        var weightCell = totalRow.insertCell();
                                        weightCell.textContent = totalWeight;

                                        var weightCell = totalRow.insertCell();
                                        weightCell.textContent = weightedSum;

                                        var averageCell = totalRow.insertCell();
                                        var appr =  average.toFixed(2);
                                        averageCell.textContent = appr + "%";
                                        store_average.push(appr);
                                        surveyTableBody_3.appendChild(totalRow);
                                       
                                    }
option_table2.style.display = "block";
var ministry= data.line_ministry.find(function (ministry) {
        return ministry.id === selectedLineMinistry;
        });
var surveyName = ministry ? ministry.name : "survey not found";


draw_columnChart(store_survey_name , store_average ,surveyName);
console.log( "here");

console.log( store_average);
                                    // console.log("Total ANswer" + total_answer);
                                    // console.log("Total weight" + totalWeight);
                                    // console.log("weighted sum" + weightedSum);
                                    // console.log("Average ANswer" + average);
                                });
                            });

                        }

                    }
                });
               
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
            

        function clearTable(tableBody) {
            while (tableBody.firstChild) {
                tableBody.removeChild(tableBody.firstChild);
            }
        }
        function clearOptions(select) {
            while (select.firstChild) {
                select.removeChild(select.firstChild);
            }
        }
        function exportTableToExcel(tableId, filename = '') {
            var downloadLink;
            var dataType = 'application/vnd.ms-excel';
            var tableSelect = document.getElementById(tableId);
            var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

            filename = filename ? filename + '.xlsb' : 'excel_data.xlsb';

            downloadLink = document.createElement("a");

            document.body.appendChild(downloadLink);

            if (navigator.msSaveOrOpenBlob) {
                var blob = new Blob(['\ufeff', tableHTML], {
                    type: dataType
                });
                navigator.msSaveOrOpenBlob(blob, filename);
            } else {
                downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
                downloadLink.download = filename;
                downloadLink.click();
            }
        }

        document.getElementById('exportButton').onclick = function () {
            exportTableToExcel('survey_detail', 'exported_table');
        }
        document.getElementById('exportButton_1').onclick = function () {
            exportTableToExcel('surveyTable', 'exported_table');
        }

        document.getElementById('exportButton_2').onclick = function () {
            exportTableToExcel('general_Survey_Info', 'exported_table');
        }
        Highcharts.chart('pieChart', {
            chart: {
                type: 'variablepie'
            },
            title: {
                text: 'Countries compared by population density and total area, 2022.',
                align: 'left'
            },
            tooltip: {
                headerFormat: '',
                pointFormat: '<span style="color:{point.color}">\u25CF</span> <b> {point.name}</b><br/>' +
                    'Area (square km): <b>{point.y}</b><br/>' +
                    'Population density (people per square km): <b>{point.z}</b><br/>'
            },
            series: [{
                minPointSize: 10,
                innerSize: '20%',
                zMin: 0,
                name: 'countries',
                borderRadius: 5,
                data: [{
                    name: 'Spain',
                    y: 505992,
                    z: 92
                }, {
                    name: 'France',
                    y: 551695,
                    z: 119
                }, {
                    name: 'Poland',
                    y: 312679,
                    z: 121
                }, {
                    name: 'Czech Republic',
                    y: 78865,
                    z: 136
                }, {
                    name: 'Italy',
                    y: 301336,
                    z: 200
                }, {
                    name: 'Switzerland',
                    y: 41284,
                    z: 213
                }, {
                    name: 'Germany',
                    y: 357114,
                    z: 235
                }],
                colors: [
                    '#4caefe',
                    '#3dc3e8',
                    '#2dd9db',
                    '#1feeaf',
                    '#0ff3a0',
                    '#00e887',
                    '#23e274'
                ]
            }]
        });
       function draw_columnChart(x,y,z){
        const numericStoreAverage = y.map(value => parseFloat(value));
        Highcharts.chart('container', {
  chart: {
    type: 'column'
  },
  title: {
    text: z,
    align: 'left'
  },
  subtitle: {
    text:
      'Source: <a target="_blank" ' +
      'href="https://www.indexmundi.com/agriculture/?commodity=corn">indexmundi</a>',
    align: 'left'
  },
  xAxis: {
    categories: x,
    crosshair: true,
    accessibility: {
      description: 'Countries'
    }
  },
  yAxis: {
    min: 0,
    title: {
      text: ''
    }
  },
  tooltip: {
    valueSuffix: ''
  },
  plotOptions: {
    column: {
      pointPadding: 0.2,
      borderWidth: 0
    }
  },
  series: [
    {
      name: 'Average',
      data: numericStoreAverage
    }
    // ,
    // {
    //   name: 'Wheat',
    //   data: [51086, 136000, 5500, 141000, 107180, 77000]
    // }
  ]
});
}
   


// function initializeDataTable() {
//     var table = $('#survey_detail').DataTable( {
//         lengthChange: true,
//         buttons: [ 'copy', 'excel', 'pdf', 'colvis' ]
//     } );
 
//     table.buttons().container()
//         .insertBefore( '#survey_detail_filter' );
// }


$(document).ready(function() {
    var table = $('#example').DataTable( {
        lengthChange: true,
        buttons: [ 'copy', 'excel', 'pdf', 'colvis' ]
    } );
 
    table.buttons().container()
        .insertBefore( '#example_filter' );
} );

   
   </script>

</body>

</html>